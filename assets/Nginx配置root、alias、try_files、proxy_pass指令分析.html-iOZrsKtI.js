import{_ as a,o as n,c as s,a as e}from"./app-fr3Buw_y.js";const p={},t=e(`<h2 id="nginx配置root、alias、try-files、proxy-pass指令分析" tabindex="-1"><a class="header-anchor" href="#nginx配置root、alias、try-files、proxy-pass指令分析" aria-hidden="true">#</a> Nginx配置root、alias、try_files、proxy_pass指令分析</h2><p>摘要：本文主要介绍root、alias指令在配置前端项目的时候的区别，下面的配置都是基于react或者vue项目配置的，不是静态服务器文件方式，因为加了try_files参数。</p><h2 id="root指令" tabindex="-1"><a class="header-anchor" href="#root指令" aria-hidden="true">#</a> root指令</h2><h4 id="示例一" tabindex="-1"><a class="header-anchor" href="#示例一" aria-hidden="true">#</a> 示例一</h4><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>server <span class="token punctuation">{</span>
    listen       <span class="token number">80</span><span class="token punctuation">;</span>
    location <span class="token operator">/</span> <span class="token punctuation">{</span>
        root <span class="token operator">/</span>data<span class="token punctuation">;</span>
        index index<span class="token punctuation">.</span>html index<span class="token punctuation">.</span>htm<span class="token punctuation">;</span>
        try_files $uri $uri<span class="token operator">/</span> <span class="token operator">/</span>index<span class="token punctuation">.</span>html<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>结果 访问路径：http://127.0.0.1:80/index.html 实际访问/data/index.html 访问路径：http://127.0.0.1:80/a/index.html 实际访问/data/a/index.html</p><h2 id="示例二" tabindex="-1"><a class="header-anchor" href="#示例二" aria-hidden="true">#</a> 示例二</h2><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>location <span class="token operator">/</span>a <span class="token punctuation">{</span>
  root <span class="token operator">/</span>data<span class="token punctuation">;</span>
  index index<span class="token punctuation">.</span>html index<span class="token punctuation">.</span>htm<span class="token punctuation">;</span>
  try_files $uri $uri<span class="token operator">/</span> <span class="token operator">/</span>index<span class="token punctuation">.</span>html<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>结果 访问路径：http://127.0.0.1:80/a/index.html 实际访问/data/a/index.html 访问路径：http://127.0.0.1:80/aaab/index.html 实际访问/data/aaab/index.html</p><h1 id="结论" tabindex="-1"><a class="header-anchor" href="#结论" aria-hidden="true">#</a> 结论</h1><p>root指令实际访问的文件路径是root路径+location路径</p><h1 id="alias指令" tabindex="-1"><a class="header-anchor" href="#alias指令" aria-hidden="true">#</a> alias指令</h1><p>我个人建议alias指令后面的路径都加上/，因为大多数我们配置的都是指定到固定文件夹，除非你的location匹配的是固定的文件，那么你alias也可以指定固定文件路径</p><h2 id="示例一-1" tabindex="-1"><a class="header-anchor" href="#示例一-1" aria-hidden="true">#</a> 示例一</h2><p>配置指定的文件路径</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>server <span class="token punctuation">{</span>
    listen       <span class="token number">80</span><span class="token punctuation">;</span>
    location <span class="token operator">/</span>index<span class="token punctuation">.</span>html <span class="token punctuation">{</span>
      alias <span class="token operator">/</span>data<span class="token operator">/</span>index<span class="token punctuation">.</span>html<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>结果 访问路径：http://127.0.0.1:80/index.html 实际访问/data/index.html 访问其他地址都会报<code>404 Not Found</code></p><h2 id="示例二-1" tabindex="-1"><a class="header-anchor" href="#示例二-1" aria-hidden="true">#</a> 示例二</h2><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>server <span class="token punctuation">{</span>
    listen       <span class="token number">80</span><span class="token punctuation">;</span>
    location <span class="token operator">/</span>a <span class="token punctuation">{</span>
        alias <span class="token operator">/</span>data<span class="token operator">/</span><span class="token punctuation">;</span>
        index index<span class="token punctuation">.</span>html index<span class="token punctuation">.</span>htm<span class="token punctuation">;</span>
        try_files $uri $uri<span class="token operator">/</span> <span class="token operator">/</span>index<span class="token punctuation">.</span>html<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>结果 访问路径：http://192.168.137.110:8060/a/index.html 实际访问/data/index.html 访问路径：http://192.168.137.110:8060/a/a/index.html 实际访问/data/a/index.html</p><h2 id="结论-1" tabindex="-1"><a class="header-anchor" href="#结论-1" aria-hidden="true">#</a> 结论</h2><p>alias指令会把location上配置的值去掉，然后把后缀拼接到alias指令后面，就像上面访问/a/index.html，而location是/a，最终的访问文件地址是/data/index.html。</p><h1 id="try-files指令" tabindex="-1"><a class="header-anchor" href="#try-files指令" aria-hidden="true">#</a> try_files指令</h1><p>按指定的file顺序查找存在的文件，并使用第一个找到的文件进行请求处理。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>server <span class="token punctuation">{</span>
    listen       <span class="token number">80</span><span class="token punctuation">;</span>
    location <span class="token operator">/</span>a<span class="token operator">/</span> <span class="token punctuation">{</span>
        root <span class="token operator">/</span>data<span class="token operator">/</span><span class="token punctuation">;</span>
        index index<span class="token punctuation">.</span>html index<span class="token punctuation">.</span>htm<span class="token punctuation">;</span>
        try_files $uri $uri<span class="token operator">/</span> <span class="token operator">/</span>index<span class="token punctuation">.</span>html<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>比如请求http://192.168.137.110:8060/a/qdleader.html</p><h3 id="uri" tabindex="-1"><a class="header-anchor" href="#uri" aria-hidden="true">#</a> $uri</h3><p>查找文件/data/a/qdleader.html</p><h3 id="uri-1" tabindex="-1"><a class="header-anchor" href="#uri-1" aria-hidden="true">#</a> $uri/</h3><p>查找文件夹/data/a/qdleader.html/qdleader.html文件</p><h3 id="index-html" tabindex="-1"><a class="header-anchor" href="#index-html" aria-hidden="true">#</a> /index.html</h3><p>请求http://192.168.137.110:8060/index.html路径</p><p>针对alias的多个location指令的try_files配置 为什么要加try_files指令，因为路由由前端控制了，页面刷新的时候路由重新到后端，找不到该文件，我们就把它重定向到index.html文件，交给前端解析。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>server <span class="token punctuation">{</span>
    listen       <span class="token number">80</span><span class="token punctuation">;</span>
    location <span class="token operator">/</span>mobile<span class="token operator">/</span> <span class="token punctuation">{</span>
        alias <span class="token operator">/</span>data<span class="token operator">-</span>mobile<span class="token operator">/</span><span class="token punctuation">;</span>
        index index<span class="token punctuation">.</span>html index<span class="token punctuation">.</span>htm<span class="token punctuation">;</span>
        try_files $uri $uri<span class="token operator">/</span> <span class="token operator">/</span>mobile<span class="token operator">/</span>index<span class="token punctuation">.</span>html<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    location <span class="token operator">/</span>pc<span class="token operator">/</span> <span class="token punctuation">{</span>
        alias <span class="token operator">/</span>data<span class="token operator">-</span>pc<span class="token operator">/</span><span class="token punctuation">;</span>
        index index<span class="token punctuation">.</span>html index<span class="token punctuation">.</span>htm<span class="token punctuation">;</span>
        try_files $uri $uri<span class="token operator">/</span> <span class="token operator">/</span>pc<span class="token operator">/</span>index<span class="token punctuation">.</span>html<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="proxy-pass指令" tabindex="-1"><a class="header-anchor" href="#proxy-pass指令" aria-hidden="true">#</a> proxy_pass指令</h2><p>该指令用于反向代理使用</p><h4 id="案例一-有-结尾" tabindex="-1"><a class="header-anchor" href="#案例一-有-结尾" aria-hidden="true">#</a> 案例一( 有/结尾)</h4><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>server <span class="token punctuation">{</span>
    listen       <span class="token number">80</span><span class="token punctuation">;</span>
    location <span class="token operator">/</span>apis<span class="token operator">-</span>config1<span class="token operator">/</span> <span class="token punctuation">{</span>
    	proxy_pass http<span class="token operator">:</span><span class="token operator">/</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">192.168.137.2:5021</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>结果 访问<code>http://192.168.137.110:8060/apis-config1/abc</code> 实际访问的是<code>http://192.168.137.2:5021/abc</code></p><h4 id="案例二-无-结尾" tabindex="-1"><a class="header-anchor" href="#案例二-无-结尾" aria-hidden="true">#</a> 案例二（无/结尾）</h4><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>server <span class="token punctuation">{</span>
    listen       <span class="token number">80</span><span class="token punctuation">;</span>
    location <span class="token operator">/</span>apis<span class="token operator">-</span>config2<span class="token operator">/</span> <span class="token punctuation">{</span>
        proxy_pass http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.137</span><span class="token number">.2</span><span class="token operator">:</span><span class="token number">5021</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>结果 访问<code>http://192.168.137.110:8060/apis-config2/abc</code> 实际访问的是<code>http://192.168.137.2:5021/apis-config2/abc</code></p><h4 id="案例三" tabindex="-1"><a class="header-anchor" href="#案例三" aria-hidden="true">#</a> 案例三</h4><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>server <span class="token punctuation">{</span>
    listen       <span class="token number">80</span><span class="token punctuation">;</span>
    location <span class="token operator">/</span>apis<span class="token operator">-</span>config3<span class="token operator">/</span> <span class="token punctuation">{</span>
        proxy_pass http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.137</span><span class="token number">.2</span><span class="token operator">:</span><span class="token number">5021</span><span class="token operator">/</span>apis<span class="token operator">/</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>结果 访问<code>http://192.168.137.110:8060/apis-config3/abc</code> 实际访问的是<code>http://192.168.137.2:5021/apis/abc</code></p><h4 id="案例四" tabindex="-1"><a class="header-anchor" href="#案例四" aria-hidden="true">#</a> 案例四</h4><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>server <span class="token punctuation">{</span>
    listen       <span class="token number">80</span><span class="token punctuation">;</span>
    location <span class="token operator">/</span>apis<span class="token operator">-</span>config4<span class="token operator">-</span><span class="token number">1</span><span class="token operator">/</span> <span class="token punctuation">{</span>
        proxy_pass http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.137</span><span class="token number">.2</span><span class="token operator">:</span><span class="token number">5021</span><span class="token operator">/</span>apis<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    location <span class="token operator">/</span>apis<span class="token operator">-</span>config4<span class="token operator">-</span><span class="token number">2</span> <span class="token punctuation">{</span>
        proxy_pass http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.137</span><span class="token number">.2</span><span class="token operator">:</span><span class="token number">5021</span><span class="token operator">/</span>apis<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>结果 访问<code>http://192.168.137.110:8060/apis-config4-1/abc</code> 实际访问的是<code>http://192.168.137.2:5021/apisabc</code></p><p>访问<code>http://192.168.137.110:8060/apis-config4-2/abc</code> 实际访问的是<code>http://192.168.137.2:5021/apis/abc</code></p><h4 id="案例五" tabindex="-1"><a class="header-anchor" href="#案例五" aria-hidden="true">#</a> 案例五</h4><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>server <span class="token punctuation">{</span>
    listen       <span class="token number">80</span><span class="token punctuation">;</span>
    location <span class="token operator">/</span>apis<span class="token operator">-</span>config5<span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">{</span>
        proxy_pass http<span class="token operator">:</span><span class="token operator">/</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">192.168.137.2:5021</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    location <span class="token operator">/</span>apis<span class="token operator">-</span>config5<span class="token operator">-</span><span class="token number">2</span> <span class="token punctuation">{</span>
        proxy_pass http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">192.168</span><span class="token number">.137</span><span class="token number">.2</span><span class="token operator">:</span><span class="token number">5021</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>结果 访问<code>http://192.168.137.110:8060/apis-config5-1/abc</code> 实际访问的是<code>http://192.168.137.2:5021//abc</code></p><p>访问<code>http://192.168.137.110:8060/apis-config5-2/abc</code> 实际访问的是<code>http://192.168.137.2:5021/apis-config5-2/abc</code></p><p>结论 对于这个没啥好说的，按需选取配置，不过我个人推荐都加上/符号，就按照案例一配置就能不变应万变。</p>`,54),i=[t];function o(c,l){return n(),s("div",null,i)}const d=a(p,[["render",o],["__file","Nginx配置root、alias、try_files、proxy_pass指令分析.html.vue"]]);export{d as default};
