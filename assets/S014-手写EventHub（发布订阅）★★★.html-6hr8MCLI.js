import{_ as e,o as n,c as i,a as s}from"./app-fr3Buw_y.js";const l={},d=s(`<h2 id="手写-eventhub-发布-订阅" tabindex="-1"><a class="header-anchor" href="#手写-eventhub-发布-订阅" aria-hidden="true">#</a> 手写 EventHub（发布-订阅）</h2><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>核心思路是：

使用一个对象作为缓存
on 负责把方法发布到缓存的 EventName 对应的数组
emit 负责遍历触发（订阅） EventName 下的方法数组
off 找方法的索引，并删除

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>class EventEmitter {
  constructor() {
    this.events = {};
  }
  // 实现订阅
  on(type, callBack) {
    if (!this.events[type]) {
      this.events[type] = [callBack];
    } else {
      this.events[type].push(callBack);
    }
  }
  // 删除订阅
  off(type, callBack) {
    if (!this.events[type]) return;
    this.events[type] = this.events[type].filter((item) =&gt; {
      return item !== callBack;
    });
  }
  // 只执行一次订阅事件
  once(type, callBack) {
    function fn() {
      callBack();
      this.off(type, fn);
    }
    this.on(type, fn);
  }
  // 触发事件
  emit(type, ...rest) {
    this.events[type] &amp;&amp;
      this.events[type].forEach((fn) =&gt; fn.apply(this, rest));
  }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>// 使用如下




// const event = new EventEmitter();

// const handle = (...rest) =&gt; {
//   console.log(rest);
// };

// event.on(&quot;click&quot;, handle);

// event.emit(&quot;click&quot;, 1, 2, 3, 4);

// event.off(&quot;click&quot;, handle);

// event.emit(&quot;click&quot;, 1, 2);

// event.once(&quot;dbClick&quot;, () =&gt; {
//   console.log(123456);
// });
// event.emit(&quot;dbClick&quot;);
// event.emit(&quot;dbClick&quot;);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,4),v=[d];function t(a,c){return n(),i("div",null,v)}const u=e(l,[["render",t],["__file","S014-手写EventHub（发布订阅）★★★.html.vue"]]);export{u as default};
